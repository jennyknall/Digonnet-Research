%define constants
sim_time=300;    %[sec]
t_steps=10000;
dt=sim_time/t_steps; %[sec]
L=110.11;    %[cm]
dz=0.11;    %[cm]
z_points=round(L/dz)+1;
z=0:dz:L;
RT=300; %[K]
R=6e-6; %6 micron radius
k_conv=0.1e-4;  %W/cm^2
%k_conv=0;
k_cond=0.014; %W/cmK
A_r=pi*R^2;     %Area for conduction [cm^2]
A_circ=2*pi*R*dz;   %Area for convection [cm^2]
C=680;  %Heat Capacity [J/kgK]
rho=2.65e-3;    %[kg/cm^3]
B=rho*A_r*dz*C;

%initial conditions
Temps=RT*ones(t_steps,z_points);

%defining the heat source: [Q_laser]=W/cm^3
Q_data=[-0.228305453650247,-0.228121376641248,-0.227553117191782,-0.226603574421883,-0.225275527048677,-0.223571655636295,-0.221494566346646,-0.219046816269522,-0.216230940416597,-0.213049480464051,-0.209505015326865,-0.205600193646575,-0.201337768276989,-0.196720632841004,-0.191751860435449,-0.186434744548833,-0.180772842253496,-0.174770019718977,-0.168430500084881,-0.161758913716522,-0.154760350843180,-0.147440416567807,-0.139805288202357,-0.131861774859271,-0.123617379196876,-0.115080361175973,-0.106259803645759,-0.0971656795235631,-0.0878089202864345,-0.0782014854251507,-0.0683564324469437,-0.0582879869450998,-0.0480116121657872,-0.0375440774208506,-0.0269035246035223,-0.0161095319626803,-0.00518317418546133,0.00585292226319822,0.0169745297183361,0.0281557770898679,0.0393691162338286,0.0505852984269701,0.0617733625613965,0.0729006367703882,0.0839327552827847,0.0948336923668123,0.105565815270634,0.116089958078671,0.126365518380858,0.136350578588086,0.146002053611220,0.155275866450900,0.164127153003470,0.172510497082691,0.180380196266320,0.187690558707725,0.194396230493652,0.200452552486794,0.205815944867620,0.210444316777924,0.214297497609859,0.217337685550483,0.219529908051296,0.220842487936636,0.221247507941516,0.220721265618511,0.219244709810482,0.216803849293310,0.213390123812182,0.209000727588684,0.203638875526387,0.197314002809403,0.190041889401996,0.181844702128373,0.172750948530222,0.162795338549611,0.152018552214653,0.140466913860269,0.128191975913062,0.115250017811515,0.101701468120080,0.0876102602147171,0.0730431339591853,0.0580688974628529,0.0427576642203213,0.0271800816255627,0.0114065669871586,-0.00449343325355223,-0.0204521463686298,-0.0364041249743057,-0.0522868360361013,-0.0680411780227139,-0.0836119193785283,-0.0989480539793650,-0.114003071714126,-0.128735144698954,-0.143107231790598,-0.157087105948653,-0.170647310558437,-0.183765052030807,-0.196422036843789];
Q_laser=zeros(1,z_points);
Q_laser((z_points/2-50):(z_points/2+50))=Q_data;    %[W/cm]
Q_source=dz*dt*A_r*Q_laser; %[J/step]=[J]

for n=2:t_steps
   for m=2:z_points-1
      Temps(n,m)=Temps(n-1,m)-k_cond*A_r*dt*(2*Temps(n-1,m)-Temps(n-1,m-1)-Temps(n-1,m+1))/dz/B-k_conv*A_circ*dt*(Temps(n-1,m)-RT)/B+Q_source(m)/B;
      if(abs(Temps(n,m)-Temps(n-1,m))>10)
          dT=Temps(n,m)-Temps(n-1,m)
          error('Time Step too small. dT>10K');
      end      
   end   
end

figure;
yyaxis left;
plot(z,Temps(t_steps,:),'linewidth',2);
hold on;
plot(z,Temps(t_steps/2,:),'linewidth',2);
xlabel('z [cm]','fontsize',16);
ylabel('Temperature [K]','fontsize',16);

yyaxis right;
plot(z,Q_laser,'linewidth',2);
ylabel('Laser Cooling [W/cm]');

leg=legend('Profile at t=sim\_time','Profile at t=sim\_time/2','Laser Cooling Rate');
set(leg,'fontsize',16);